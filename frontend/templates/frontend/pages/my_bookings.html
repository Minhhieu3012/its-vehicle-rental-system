{% extends 'base.html' %}

{% block title %}Đơn hàng của tôi - Vehicle Rental{% endblock %}

{% block extra_css %}
<style>
    .page-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        padding: var(--spacing-2xl) 0;
        color: #fff;
        margin-bottom: var(--spacing-xl);
    }
    
    .page-title {
        font-size: 2.5rem;
        margin-bottom: var(--spacing-sm);
    }
    
    .page-subtitle {
        font-size: 1.125rem;
        color: rgba(255, 255, 255, 0.9);
    }
    
    .tabs {
        display: flex;
        gap: var(--spacing-md);
        margin-bottom: var(--spacing-xl);
        border-bottom: 2px solid var(--gray-200);
    }
    
    .tab {
        padding: var(--spacing-md) var(--spacing-xl);
        font-weight: 600;
        color: var(--gray-600);
        cursor: pointer;
        border-bottom: 3px solid transparent;
        margin-bottom: -2px;
        transition: all var(--transition-fast);
    }
    
    .tab:hover {
        color: var(--primary);
    }
    
    .tab.active {
        color: var(--primary);
        border-bottom-color: var(--primary);
    }
    
    .bookings-grid {
        display: grid;
        gap: var(--spacing-lg);
    }
    
    .booking-card {
        background: #fff;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-sm);
        overflow: hidden;
        display: grid;
        grid-template-columns: 200px 1fr auto;
        gap: var(--spacing-lg);
        transition: all var(--transition-base);
    }
    
    .booking-card:hover {
        box-shadow: var(--shadow-lg);
        transform: translateY(-2px);
    }
    
    .booking-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }
    
    .booking-info {
        padding: var(--spacing-lg) 0;
        flex: 1;
    }
    
    .booking-header {
        display: flex;
        align-items: start;
        justify-content: space-between;
        margin-bottom: var(--spacing-md);
    }
    
    .booking-badge {
        padding: var(--spacing-xs) var(--spacing-md);
        border-radius: var(--radius-full);
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
    }
    
    .booking-badge.pending {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning);
    }
    
    .booking-badge.confirmed {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
    }
    
    .booking-badge.completed {
        background: rgba(37, 99, 235, 0.1);
        color: var(--primary);
    }
    
    .booking-badge.cancelled {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
    }
    
    .booking-title {
        font-size: 1.25rem;
        font-weight: 700;
        margin-bottom: var(--spacing-sm);
        color: var(--gray-900);
    }
    
    .booking-id {
        font-size: 0.875rem;
        color: var(--gray-600);
        margin-bottom: var(--spacing-md);
    }
    
    .booking-details {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-md);
    }
    
    .booking-detail {
        display: flex;
        align-items: center;
        gap: var(--spacing-sm);
        color: var(--gray-700);
        font-size: 0.938rem;
    }
    
    .booking-detail i {
        color: var(--primary);
        width: 20px;
    }
    
    .booking-actions {
        padding: var(--spacing-lg);
        display: flex;
        flex-direction: column;
        gap: var(--spacing-md);
        justify-content: center;
        background: var(--gray-50);
    }
    
    .booking-price {
        text-align: center;
        margin-bottom: var(--spacing-md);
    }
    
    .booking-price-amount {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--primary);
        display: block;
    }
    
    .booking-price-label {
        font-size: 0.875rem;
        color: var(--gray-600);
    }
    
    .empty-state {
        text-align: center;
        padding: var(--spacing-3xl);
        background: #fff;
        border-radius: var(--radius-xl);
        box-shadow: var(--shadow-sm);
    }
    
    .empty-state i {
        font-size: 4rem;
        color: var(--gray-300);
        margin-bottom: var(--spacing-lg);
    }
    
    .empty-state h3 {
        font-size: 1.5rem;
        margin-bottom: var(--spacing-sm);
        color: var(--gray-700);
    }
    
    .empty-state p {
        color: var(--gray-600);
        margin-bottom: var(--spacing-lg);
    }
    
    @media (max-width: 768px) {
        .booking-card {
            grid-template-columns: 1fr;
        }
        .booking-details {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <div class="container">
        <h1 class="page-title">Đơn hàng của tôi</h1>
        <p class="page-subtitle">Theo dõi và quản lý các yêu cầu thuê xe của bạn trên toàn hệ thống</p>
    </div>
</div>

<div class="container">
    <!-- Tabs -->
    <div class="tabs">
        <div class="tab active" onclick="filterBookings('all')">
            <i class="fas fa-list"></i> Tất cả
        </div>
        <div class="tab" onclick="filterBookings('pending')">
            <i class="fas fa-clock"></i> Chờ xác nhận
        </div>
        <div class="tab" onclick="filterBookings('confirmed')">
            <i class="fas fa-check-circle"></i> Đã duyệt
        </div>
        <div class="tab" onclick="filterBookings('completed')">
            <i class="fas fa-flag-checkered"></i> Đã hoàn thành
        </div>
        <div class="tab" onclick="filterBookings('cancelled')">
            <i class="fas fa-times-circle"></i> Đã hủy
        </div>
    </div>
    
    <!-- Bookings List -->
    <div class="bookings-grid" id="bookingsGrid">
        {% for booking in bookings %}
        <div class="booking-card" data-status="{{ booking.status }}">
            <img src="{{ booking.vehicle.image.url }}" alt="{{ booking.vehicle.name }}" class="booking-image">
            
            <div class="booking-info">
                <div class="booking-header">
                    <div>
                        <h3 class="booking-title">{{ booking.vehicle.name }}</h3>
                        <div class="booking-id">
                            <i class="fas fa-hashtag"></i>
                            Mã đơn: <strong>{{ booking.id }}</strong>
                        </div>
                    </div>
                    <span class="booking-badge {{ booking.status }}">
                        {% if booking.status == 'pending' %}Chờ xác nhận
                        {% elif booking.status == 'confirmed' %}Đã duyệt
                        {% elif booking.status == 'completed' %}Đã hoàn thành
                        {% else %}Đã hủy{% endif %}
                    </span>
                </div>
                
                <div class="booking-details">
                    <div class="booking-detail">
                        <i class="fas fa-calendar-alt"></i>
                        <span><strong>Nhận xe:</strong> {{ booking.start_date|date:"d/m/Y H:i" }}</span>
                    </div>
                    <div class="booking-detail">
                        <i class="fas fa-calendar-check"></i>
                        <span><strong>Trả xe:</strong> {{ booking.end_date|date:"d/m/Y H:i" }}</span>
                    </div>
                    <div class="booking-detail">
                        <i class="fas fa-clock"></i>
                        <span><strong>Thời gian:</strong> {{ booking.duration }} ngày</span>
                    </div>
                    <div class="booking-detail">
                        <i class="fas fa-map-marker-alt"></i>
                        <span><strong>Điểm nhận:</strong> Chi nhánh Quận 1, TP.HCM</span>
                    </div>
                </div>
            </div>
            
            <div class="booking-actions">
                <div class="booking-price">
                    <span class="booking-price-amount">{{ booking.total_price|floatformat:0 }}k VNĐ</span>
                    <span class="booking-price-label">Tổng thanh toán</span>
                </div>
                
                {% if booking.status == 'pending' %}
                    <button class="btn btn-danger btn-sm" onclick="cancelBooking({{ booking.id }})">
                        <i class="fas fa-times"></i>
                        Hủy đơn
                    </button>
                {% elif booking.status == 'confirmed' %}
                    <button class="btn btn-success btn-sm">
                        <i class="fas fa-phone"></i>
                        Liên hệ hỗ trợ
                    </button>
                {% elif booking.status == 'completed' %}
                    <button class="btn btn-primary btn-sm" onclick="reviewVehicle({{ booking.vehicle.id }})">
                        <i class="fas fa-star"></i>
                        Đánh giá & Nhận xét
                    </button>
                {% endif %}
                
                <a href="{% url 'vehicle_detail' booking.vehicle.id %}" class="btn btn-outline btn-sm">
                    <i class="fas fa-eye"></i>
                    Xem chi tiết
                </a>
            </div>
        </div>
        {% empty %}
        <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <h3>Chưa có đơn hàng nào</h3>
            <p>Bạn chưa có yêu cầu thuê xe nào. Hãy bắt đầu khám phá các xe tuyệt vời!</p>
            <a href="{% url 'vehicle_list' %}" class="btn btn-primary">
                <i class="fas fa-car"></i>
                Tìm xe ngay
            </a>
        </div>
        {% endfor %}
    </div>
    
    <!-- Help Section -->
    <div style="background: rgba(37, 99, 235, 0.05); padding: var(--spacing-2xl); border-radius: var(--radius-xl); margin-top: var(--spacing-2xl); text-align: center;">
        <h3 style="margin-bottom: var(--spacing-md);">Cần trợ giúp về đơn hàng?</h3>
        <p style="color: var(--gray-700); margin-bottom: var(--spacing-lg);">
            Nếu bạn gặp bất kỳ vấn đề nào trong quá trình thuê xe, hãy liên hệ với đội ngũ hỗ trợ 24/7 của chúng tôi
        </p>
        <div style="display: flex; gap: var(--spacing-md); justify-content: center;">
            <a href="tel:19001234" class="btn btn-primary">
                <i class="fas fa-phone"></i>
                Gọi: 1900 1234
            </a>
            <button class="btn btn-outline">
                <i class="fas fa-comments"></i>
                Trung tâm hỗ trợ
            </button>
        </div>
    </div>
</div>

<script>
    function filterBookings(status) {
        const cards = document.querySelectorAll('.booking-card');
        const tabs = document.querySelectorAll('.tab');
        
        // Update active tab
        tabs.forEach(tab => tab.classList.remove('active'));
        event.target.closest('.tab').classList.add('active');
        
        // Filter cards
        cards.forEach(card => {
            if (status === 'all' || card.dataset.status === status) {
                card.style.display = 'grid';
            } else {
                card.style.display = 'none';
            }
        });
    }
    
    function cancelBooking(id) {
        if (confirm('Bạn có chắc muốn hủy đơn hàng này?')) {
            // Call API to cancel booking
            alert('Đã hủy đơn hàng #' + id);
            location.reload();
        }
    }
    
    function reviewVehicle(vehicleId) {
        alert('Chức năng đánh giá đang được phát triển');
    }
</script>
{% endblock %}