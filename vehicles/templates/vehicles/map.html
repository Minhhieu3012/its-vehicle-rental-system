{% load static %} <!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ITS Map Module</title>

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css"
    />

    <link rel="stylesheet" href="{% static 'vehicles/css/map_style.css' %}" />
  </head>

  <body>
    <div id="map"></div>

    <div id="routeModal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h3>üìç Chi ti·∫øt l·ªô tr√¨nh</h3>
          <span class="close-btn" onclick="closeModal()">&times;</span>
        </div>

        <div class="modal-body">
          <div id="route-summary" class="summary-box">Loading...</div>

          <h4>H∆∞·ªõng d·∫´n di chuy·ªÉn:</h4>
          <ul id="route-instructions" class="instruction-list"></ul>
        </div>

        <div class="modal-footer">
          <button class="btn-cancel" onclick="closeModal()">ƒê√≥ng</button>
        </div>
      </div>
    </div>

    <div id="termsModal" class="modal-overlay">
      <div class="modal-content" style="max-width: 700px">
        <div class="modal-header" style="background: #2c3e50; color: white">
          <h3 style="margin: 0">üìú ƒêI·ªÄU KHO·∫¢N & CH√çNH S√ÅCH THU√ä XE</h3>
          <span
            class="close-btn"
            onclick="closeTermsModal()"
            style="color: white"
            >&times;</span
          >
        </div>

        <div
          class="modal-body"
          style="
            font-size: 14px;
            line-height: 1.6;
            max-height: 50vh;
            overflow-y: auto;
          "
        >
          <div
            style="
              background: #e8f5e9;
              padding: 15px;
              border-radius: 8px;
              margin-bottom: 20px;
              border-left: 5px solid #28a745;
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            <div>
              <span style="display: block; font-size: 12px; color: #666"
                >ƒêang xem ch√≠nh s√°ch cho xe:</span
              >
              <h3
                style="margin: 0; color: #28a745; font-size: 20px"
                id="term-car-name"
              >
                T√™n xe...
              </h3>
            </div>
            <div style="text-align: right">
              <span style="display: block; font-size: 12px; color: #666"
                >ƒê∆°n gi√° ti√™u chu·∫©n:</span
              >
              <strong
                style="font-size: 20px; color: #d63031"
                id="term-car-price"
                >0ƒë/ng√†y</strong
              >
            </div>
          </div>

          <div class="policy-content">
            <h5
              style="
                color: #007bff;
                border-bottom: 2px solid #eee;
                padding-bottom: 5px;
              "
            >
              1. GI√Å THU√ä
            </h5>
            <ul style="padding-left: 20px">
              <li>Gi√° thu√™ theo t·ª´ng lo·∫°i xe (xem b·∫£ng gi√° chi ti·∫øt tr√™n).</li>
              <li>T√≠nh theo ng√†y (24 gi·ªù k·ªÉ t·ª´ khi nh·∫≠n xe).</li>
              <li>
                <strong>Tr·∫£ xe tr·ªÖ:</strong>
                <ul style="margin-top: 5px">
                  <li>D∆∞·ªõi 1 gi·ªù: Mi·ªÖn ph√≠</li>
                  <li>T·ª´ 1-3 gi·ªù: +200.000ƒë</li>
                  <li>Tr√™n 3 gi·ªù: T√≠nh th√™m 1 ng√†y thu√™</li>
                </ul>
              </li>
            </ul>

            <h5
              style="
                color: #007bff;
                border-bottom: 2px solid #eee;
                padding-bottom: 5px;
                margin-top: 20px;
              "
            >
              2. NHI√äN LI·ªÜU
            </h5>
            <ul style="padding-left: 20px">
              <li>Kh√°ch t·ª± t√∫c chi ph√≠ xƒÉng/ƒëi·ªán.</li>
              <li><strong>Giao xe:</strong> ƒê·∫ßy b√¨nh/Pin ƒë·∫ßy.</li>
              <li>
                <strong>Tr·∫£ xe:</strong> ƒê·∫ßy b√¨nh/Pin ƒë·∫ßy (ho·∫∑c b·ªìi ho√†n chi ph√≠
                nhi√™n li·ªáu thi·∫øu theo gi√° th·ªã tr∆∞·ªùng).
              </li>
            </ul>

            <h5
              style="
                color: #007bff;
                border-bottom: 2px solid #eee;
                padding-bottom: 5px;
                margin-top: 20px;
              "
            >
              3. QU√ÉNG ƒê∆Ø·ªúNG
            </h5>
            <ul style="padding-left: 20px">
              <li>Kh√¥ng gi·ªõi h·∫°n trong l√£nh th·ªï Vi·ªát Nam.</li>
              <li>
                ƒêi ngo√†i t·ªânh/th√†nh ph·ªë n∆°i nh·∫≠n xe:
                <strong>Vui l√≤ng b√°o tr∆∞·ªõc</strong>.
              </li>
              <li>‚ùå <strong>Kh√¥ng cho ph√©p</strong> ƒë∆∞a xe ra n∆∞·ªõc ngo√†i.</li>
            </ul>

            <h5
              style="
                color: #007bff;
                border-bottom: 2px solid #eee;
                padding-bottom: 5px;
                margin-top: 20px;
              "
            >
              4. TI·ªÄN C·ªåC & GI·∫§Y T·ªú
            </h5>
            <ul style="padding-left: 20px">
              <li>
                <strong>Ti·ªÅn c·ªçc (Ho·∫∑c gi·ªØ CMND/CCCD g·ªëc + H·ªô kh·∫©u):</strong>
                <ul style="margin-top: 5px">
                  <li>Xe s·ªë t·ª± ƒë·ªông/xe cao c·∫•p: 15.000.000ƒë - 30.000.000ƒë</li>
                  <li>Xe s·ªë s√†n/xe ph·ªï th√¥ng: 10.000.000ƒë - 15.000.000ƒë</li>
                  <li>Xe m√°y: 3.000.000ƒë - 5.000.000ƒë</li>
                </ul>
              </li>
              <li>
                <strong>Gi·∫•y t·ªù b·∫Øt bu·ªôc:</strong>
                <ul style="margin-top: 5px">
                  <li>CMND/CCCD (b·∫£n g·ªëc).</li>
                  <li>GPLX h·ª£p l·ªá (A1/A2 cho xe m√°y, B1/B2 cho √¥ t√¥).</li>
                  <li>S·ªï h·ªô kh·∫©u ho·∫∑c gi·∫•y t·ªù thay th·∫ø.</li>
                </ul>
              </li>
            </ul>

            <h5
              style="
                color: #007bff;
                border-bottom: 2px solid #eee;
                padding-bottom: 5px;
                margin-top: 20px;
              "
            >
              5. ƒêI·ªÄU KI·ªÜN THU√ä XE
            </h5>
            <ul style="padding-left: 20px">
              <li>
                <strong>ƒê·ªô tu·ªïi:</strong> T·ª´ 18 tu·ªïi (xe m√°y), t·ª´ 23 tu·ªïi (√¥
                t√¥).
              </li>
              <li>
                <strong>Kinh nghi·ªám l√°i:</strong> GPLX c√≥ th√¢m ni√™n t·ªëi thi·ªÉu 2
                nƒÉm (√¥ t√¥), 1 nƒÉm (xe m√°y).
              </li>
              <li>
                Kh√¥ng c√≥ ti·ªÅn √°n ti·ªÅn s·ª± li√™n quan ƒë·∫øn ma t√∫y, tr·ªôm c·∫Øp ph∆∞∆°ng
                ti·ªán.
              </li>
            </ul>

            <h5
              style="
                color: #007bff;
                border-bottom: 2px solid #eee;
                padding-bottom: 5px;
                margin-top: 20px;
              "
            >
              6. B·∫¢O HI·ªÇM & TR√ÅCH NHI·ªÜM
            </h5>
            <ul style="padding-left: 20px">
              <li>
                Xe c√≥ b·∫£o hi·ªÉm TNDS b·∫Øt bu·ªôc. (√î t√¥ c√≥ th√™m BH V·∫≠t ch·∫•t n·∫øu ghi
                r√µ).
              </li>
              <li>
                <strong>Tr√°ch nhi·ªám khi c√≥ s·ª± c·ªë:</strong>
                <ul style="margin-top: 5px">
                  <li>
                    Tai n·∫°n nh·ªè (x∆∞·ªõc, m√≥p): Kh√°ch b·ªìi th∆∞·ªùng chi ph√≠ s·ª≠a ch·ªØa
                    th·ª±c t·∫ø.
                  </li>
                  <li>Tai n·∫°n l·ªõn: Kh√°ch ch·ªãu m·ª©c mi·ªÖn th∆∞·ªùng 3tr - 5tr/v·ª•.</li>
                  <li>
                    M·∫•t xe/ch√°y ho√†n to√†n: Kh√°ch b·ªìi th∆∞·ªùng 100% gi√° tr·ªã xe (tr·ª´
                    ph·∫ßn b·∫£o hi·ªÉm chi tr·∫£).
                  </li>
                </ul>
              </li>
              <li>
                ‚ö†Ô∏è Kh√°ch ph·∫£i b√°o ngay cho ch·ªß xe v√† c√¥ng an khi x·∫£y ra s·ª± c·ªë.
              </li>
            </ul>

            <h5
              style="
                color: #dc3545;
                border-bottom: 2px solid #eee;
                padding-bottom: 5px;
                margin-top: 20px;
              "
            >
              7. C·∫§M NGHI√äM üö´
            </h5>
            <ul style="padding-left: 20px; color: #dc3545">
              <li>
                ‚ùå S·ª≠ d·ª•ng xe v√†o m·ª•c ƒë√≠ch phi ph√°p (v·∫≠n chuy·ªÉn h√†ng c·∫•m, ma
                t√∫y, tr·ªôm c·∫Øp...).
              </li>
              <li>‚ùå Cho thu√™ l·∫°i, c·∫ßm c·ªë, th·∫ø ch·∫•p xe.</li>
              <li>
                ‚ùå L√°i xe khi kh√¥ng c√≥ GPLX, say r∆∞·ª£u bia, s·ª≠ d·ª•ng ma t√∫y.
              </li>
              <li>‚ùå T·ª± √Ω s·ª≠a ch·ªØa, thay ƒë·ªïi k·∫øt c·∫•u xe.</li>
              <li>‚ùå Tham gia ƒëua xe, off-road (tr·ª´ xe chuy√™n d·ª•ng).</li>
              <li>
                <strong
                  >Vi ph·∫°m = T·ªãch thu c·ªçc + B·ªìi th∆∞·ªùng + X·ª≠ l√Ω ph√°p l√Ω.</strong
                >
              </li>
            </ul>

            <h5
              style="
                color: #007bff;
                border-bottom: 2px solid #eee;
                padding-bottom: 5px;
                margin-top: 20px;
              "
            >
              8. C√ÅC ƒêI·ªÄU KHO·∫¢N KH√ÅC
            </h5>
            <ul style="padding-left: 20px">
              <li>
                <strong>Ph·∫°t ngu·ªôi:</strong> Kh√°ch ch·ªãu 100% ph√≠ + ph√≠ thu√™ xe
                k√©o d√†i n·∫øu xe b·ªã giam.
              </li>
              <li>
                <strong>V·ªá sinh:</strong> Tr·∫£ xe s·∫°ch s·∫Ω. Xe qu√° b·∫©n thu ph√≠
                100k - 500k.
              </li>
              <li>
                <strong>H·ªßy l·ªãch:</strong>
                <ul>
                  <li>Tr∆∞·ªõc 24h: Ho√†n 100% c·ªçc.</li>
                  <li>12-24h: Ho√†n 50%.</li>
                  <li>D∆∞·ªõi 12h: Kh√¥ng ho√†n ti·ªÅn.</li>
                </ul>
              </li>
            </ul>

            <div
              style="
                background: #f8f9fa;
                padding: 15px;
                margin-top: 30px;
                border-radius: 8px;
                text-align: center;
              "
            >
              <strong>L∆ØU √ù:</strong> ƒê·ªçc k·ªπ ƒëi·ªÅu kho·∫£n tr∆∞·ªõc khi thu√™. Gi·ªØ g√¨n
              xe nh∆∞ xe c·ªßa m√¨nh.<br />
              <div style="margin-top: 10px; font-size: 16px">
                üìû Hotline h·ªó tr·ª£ 24/7: <strong>0909.xxx.xxx</strong><br />
                ‚úâÔ∏è Email: <strong>hotro@thuexeits.vn</strong>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-footer">
          <button
            class="btn-cancel"
            onclick="closeTermsModal()"
            style="background: #2c3e50; color: white"
          >
            ƒê√£ hi·ªÉu & ƒê·ªìng √Ω
          </button>
        </div>
      </div>
    </div>

    <div id="locationModal" class="modal-overlay">
      <div class="modal-content" style="max-width: 450px">
        <div class="modal-header" style="background: #17a2b8; color: white">
          <h3 style="margin: 0">üìç Th√¥ng tin ƒë·ªãa ƒëi·ªÉm</h3>
          <span
            class="close-btn"
            onclick="closeLocationModal()"
            style="color: white"
            >&times;</span
          >
        </div>

        <div
          class="modal-body"
          style="font-family: &quot;Segoe UI&quot;, sans-serif; padding: 20px"
        >
          <h4
            id="loc-car-name"
            style="
              margin-top: 0;
              color: #17a2b8;
              border-bottom: 1px solid #eee;
              padding-bottom: 10px;
            "
          >
            T√™n xe...
          </h4>

          <div style="margin-top: 15px">
            <p style="margin-bottom: 10px">
              <strong>üè† ƒê·ªãa ch·ªâ l·∫•y xe:</strong><br />
              <span
                style="
                  color: #555;
                  display: block;
                  margin-top: 5px;
                  background: #f8f9fa;
                  padding: 8px;
                  border-radius: 4px;
                  border-left: 3px solid #17a2b8;
                "
              >
                123 Nguy·ªÖn VƒÉn Linh, P. T√¢n Ph√∫, Q.7, TP.HCM
              </span>
            </p>

            <p style="margin-bottom: 10px">
              <strong>üïê Gi·ªù m·ªü c·ª≠a:</strong>
              <span style="font-weight: 600">7:00 - 22:00</span>
            </p>

            <div
              style="
                background: #e8f5e9;
                padding: 12px;
                border-radius: 6px;
                margin: 15px 0;
              "
            >
              <strong style="color: #2e7d32">üöó H·ªó tr·ª£:</strong>
              <ul style="margin: 5px 0 0 0; padding-left: 20px; color: #333">
                <li>‚úì Giao xe t·∫≠n n∆°i (30.000ƒë/km)</li>
                <li>‚úì Mi·ªÖn ph√≠ trong b√°n k√≠nh 5km</li>
              </ul>
            </div>

            <p style="font-size: 15px">
              <strong>üìû Li√™n h·ªá ch·ªß xe:</strong>
              <a
                href="tel:0901234567"
                style="
                  color: #d63031;
                  font-weight: bold;
                  text-decoration: none;
                  font-size: 18px;
                  margin-left: 5px;
                "
                >090 123 4567</a
              >
            </p>
          </div>
        </div>

        <div
          class="modal-footer"
          style="display: flex; gap: 10px; justify-content: flex-end"
        >
          <button
            id="btn-view-map"
            class="btn-cancel"
            style="background: #6c757d; color: white; margin: 0; flex: 1"
          >
            üîç Xem b·∫£n ƒë·ªì
          </button>
          <button
            id="btn-start-route"
            class="btn-confirm"
            style="background: #17a2b8; color: white; flex: 1"
          >
            ‚ÜóÔ∏è Ch·ªâ ƒë∆∞·ªùng
          </button>
        </div>
      </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.js"></script>

    <script src="{% static 'vehicles/js/map_logic.js' %}"></script>

    <script>
      // 1. Nh·∫≠n d·ªØ li·ªáu t·ª´ Django (Ch·ªâ file HTML m·ªõi hi·ªÉu d√≤ng n√†y)
      var vehiclesData = {{ vehicles_json|safe }};

      // 2. G·ªçi h√†m kh·ªüi t·∫°o b√™n file map_logic.js v√† truy·ªÅn d·ªØ li·ªáu v√†o
      // Ch·ªù trang t·∫£i xong m·ªõi ch·∫°y ƒë·ªÉ tr√°nh l·ªói
      document.addEventListener('DOMContentLoaded', function() {
          initMap(vehiclesData);
      });
    </script>
  </body>
</html>
